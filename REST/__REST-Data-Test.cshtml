@inherits Custom.Hybrid.RazorTyped<RestTest>
@using AppCode.RestTests
@{
  Kit.Page.Activate("2sxc.JsCore");
}
<h3>@Model.Title</h3>
<p>
  @Model.Description
</p>
<div>
  URL:
  <code id="url"></code>
</div>
<pre id="output1">
  ...loading...
</pre>

@Kit.Page.TurnOn("window.postJson()", data: Model)

<script type="text/javascript">
  // Use an IFFE to ensure the variables are not exposed globaly
  // See https://developer.mozilla.org/en-US/docs/Glossary/IIFE
  (() => {
    function postJson(data) {
      const select = data.Select
        ? "$select=" + data.Select
        : "";

      const filter = data.Filter
        ? "$filter=" + encodeURIComponent(data.Filter)
        : "";

      const combined = [select, filter]
        .filter(part => part.length > 0)
        .join("&");

      const url = 'app/auto/data/' + data.ContentType + (combined ? "?" + combined : "");
      document.getElementById("url").innerHTML = url;

      $2sxc(@MyContext.Module.Id).webApi
        .fetchJson(url)
        .then(response => {
          console.log(response);
          document.getElementById("output1").innerHTML = JSON.stringify(response, null, 2);
        });
    }
    // Generate on window so it can be called from the html
    window.postJson = postJson;
  })();
</script>
